<script>
  const yes = document.getElementById("yes");
  const no  = document.getElementById("no");
  const noSlot = document.getElementById("noSlot");
  const noTray = document.getElementById("noTray");
  const row = document.getElementById("btnRow");
  const card = document.getElementById("card");
  const result = document.getElementById("result");

  let detached = false;

  function rect(el){ return el.getBoundingClientRect(); }
  function overlap(a,b){
    return !(a.right < b.left || a.left > b.right || a.bottom < b.top || a.top > b.bottom);
  }
  function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }

  function detachNo(){
    if (detached) return;

    const r = rect(no);

    // keep YES from shifting
    noSlot.classList.add("active");
    noSlot.style.setProperty("--noW", r.width + "px");
    noSlot.style.setProperty("--noH", r.height + "px");

    // detach but keep same position
    no.style.position = "fixed";
    no.style.left = r.left + "px";
    no.style.top  = r.top  + "px";

    detached = true;
  }

  function moveNoAwayFromMouse(e){
    detachNo();

    const noR = rect(no);
    const yesR = rect(yes);
    const cardR = rect(card);

    // Center of NO
    const noCX = noR.left + noR.width / 2;
    const noCY = noR.top  + noR.height / 2;

    // Direction away from mouse
    let dx = noCX - e.clientX;
    let dy = noCY - e.clientY;

    const len = Math.hypot(dx, dy) || 1;
    dx /= len; dy /= len;

    // step size (tune if you want)
    const step = 150;

    let newX = noR.left + dx * step;
    let newY = noR.top  + dy * step;

    // CLAMP INSIDE THE WHITE BOX (CARD)
    const margin = 18;

    const minX = cardR.left + margin;
    const maxX = cardR.right - noR.width - margin;
    const minY = cardR.top + margin;
    const maxY = cardR.bottom - noR.height - margin;

    newX = clamp(newX, minX, maxX);
    newY = clamp(newY, minY, maxY);

    // Never overlap YES
    const candidate = { left:newX, top:newY, right:newX+noR.width, bottom:newY+noR.height };

    if (overlap(candidate, yesR)) {
      // push horizontally away from YES, still within the card
      if (newX < yesR.left) newX = yesR.left - noR.width - 40;
      else newX = yesR.right + 40;

      newX = clamp(newX, minX, maxX);

      // if still overlapping (rare), push vertically too
      const candidate2 = { left:newX, top:newY, right:newX+noR.width, bottom:newY+noR.height };
      if (overlap(candidate2, yesR)) {
        if (newY < yesR.top) newY = yesR.top - noR.height - 40;
        else newY = yesR.bottom + 40;

        newY = clamp(newY, minY, maxY);
      }
    }

    no.style.left = newX + "px";
    no.style.top  = newY + "px";
  }

  // tray image only while hovering NO
  function showNoTray(){ noTray.classList.add("show"); }
  function hideNoTray(){ noTray.classList.remove("show"); }

  // chase behavior ONLY while hovering NO
  no.addEventListener("mouseenter", (e) => {
    showNoTray();
    moveNoAwayFromMouse(e);
  });

  no.addEventListener("mousemove", (e) => {
    moveNoAwayFromMouse(e);
  });

  no.addEventListener("mouseleave", () => {
    hideNoTray();
  });

  // YES click
  yes.addEventListener("click", ()=>{
    hideNoTray();
    card.style.display="none";
    row.style.display="none";
    result.classList.add("show");
  });

  // if resize happens, keep NO inside the card
  window.addEventListener("resize", () => {
    if (!detached) return;
    const noR = rect(no);
    const cardR = rect(card);

    const margin = 18;
    const minX = cardR.left + margin;
    const maxX = cardR.right - noR.width - margin;
    const minY = cardR.top + margin;
    const maxY = cardR.bottom - noR.height - margin;

    const curX = parseFloat(no.style.left) || noR.left;
    const curY = parseFloat(no.style.top) || noR.top;

    no.style.left = clamp(curX, minX, maxX) + "px";
    no.style.top  = clamp(curY, minY, maxY) + "px";
  });
</script>
